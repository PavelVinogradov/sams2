<HTML>
<HEAD>
<TITLE>Проект SAMS. Документация.</TITLE>
<META  content="text/html; charset=koi8-r" http-equiv="Content-Type">
</HEAD>
<BODY>
<H2>Инсталляция SAMS</H2>

<H3>1.  Разархивируйте этот архив:</H3>
    tar zxf sams-xxxxxx.tar.gz
<P>    будет создан каталог, в котором будет размещено содержимое архива.
<H3>2.  Переместитесь в него</H3>
    сd sams-xxxxxx
<H3>3.  Соберите SAMS: </H3>
    Для настройки конфигурации воспользуйтесь командой
<BR>    % ./confugure
<P>    По путь по-умолчанию SASM находится  /usr/local.
<BR>Если вы захотите изменить путь:
<BR> - к расположению программ и путь к расположению библиотек и файлов
заголовков MySQL
<BR> - к каталогу расположения root директории http сервера (если путь к нему
отличается от /var/www/html или /var/www/htdocs
<BR> - к каталогу расположения php, воспользуйтесь ключами configure
<BR> для получения списка опций настройки наберите:
<BR>    % ./confugure --help
<P> Если на этапе конфигурирования выдаются ошибки, проверьте 
наличие <A HREF="soft.html">необходимых SAMS пакетов</A>.

<H3>4.  По завершении работы команды configure откомпилируйте дистрибутив
и инсталлируйте его.</H3>
    Linux:
<BR>   % make
<BR>    % make install
<P>    FreeBSD:
<BR >   % gmake
<BR>    % gmake install
<P> Если на этапе сборки выдаются ошибки, проверьте 
наличие <A HREF="soft.html">необходимых SAMS пакетов</A>.


<H3>5.Расположение файлов SAMS (по-умолчанию)</H3>
 По окончании инсталляции файлы SAMS будут проинсталлированы:
<BR> /etc:
<BR> sams.conf - файл конфигурации SAMS
<P> /usr/local/sams:
<BR>файлы:
<BR>sams - анализатор логов squid
<BR>samsf - демон, создающий fifo файл, в который squid записывает логи.
<BR>samsdaemon - демон, отвечающий за переконфигурацию squid и автоматический запуск sams и samsf
<P> /usr/local/share/sams:
<BR>файлы WEB-интерфейса sams
<P>Каталог SAMS http сервера: 
<BR>В результате инсталляции должен быть создан симлинк из root каталога http
сервера на каталог web-интерфейса SAMS. Если он не создан, создайте симлинк</A> из каталога 
вашего web-сервера на каталог /usr/local/share/sams
<BR>    ln -s /usr/local/share/sams /our/path/www/htdocd/sams.

<H3>6.Запуск WEB интерфейса SAMS и создание баз SAMS в MySQL</H3>
 Запустите броузер и подключитесь к WEB-интерфейсу SAMS:
<BR> http://localhost/sams

<P> Ваш httpd сервер должен поддерживать работу php скриптов.Для работы WEB интерфеса SAMS
<A HREF="soft.html">необходимо установить модули php</A>.
<BR>И настроить работу php в safe_mode: <A HREF="apache.html#PHPCONF">Настройка httpd сервера apache</A>


<P> Если базы SAMS еще не созданы, вам будет предложен диалог создания баз и пользователя 
	SAMS в MySQL. 
<BR> Заполните поля:
<BR> <B>MySQL Hostname</B>: - адрес сервера, на котором установлен MySQL
<BR> <B>MySQL login</B>: - Имя пользователя MySQL, имеющего права на создание баз данных (обычно это root)
<BR> <B>MySQL password</B>: - Пароль пользователя root
<BR> <B>Create SAMS MySQL user</B> - установите галочку, если вы хотите создать пользователя, от имени которого 
будет работать SAMS
<BR> <B>SAMS MySQL user</B>: Введите имя пользователя, от имени которого будет работать SAMS (если MySQL 
расположен на этом же хосте, то это будет, например, sams@localhost)
<BR> <B>SAMS MySQL user password</B>: Пароль  юзера sams

<P> Занесите введенные значения в файл конфигурации SAMS <A HREF="sams_conf.html">/etc/sams.conf</A>:
<BR> <B>MYSQLHOSTNAME=localhost</B>  - имя хоста, где стоит MySQL
<BR> <B>MYSQLUSER=sams</B> - Имя пользователя MySQL, от имени которого будет работать SAMS (sams@localhost писать ненадо!)
<BR> <B>MYSQLPASSWORD=yourpasswd</B> - Пароль пользователя в MySQL

<P> Нажмите на кнопку "Create database", и, если поля формы были заполнены правильно, базы и 
пользователь SAMS будут созданы.
<P> Нажмите на кнопку "Starting SAMS web interface".
<P> Если данные в файл конфигурации sams.conf были занесены верно, то будет выведен WEB-интерфейс SAMS.

<H3>7. Измените владельца каталога /usr/local/share/sams на пользователя, от имени
которого работает ваш web сервер</H3>
   например:
<BR>    chown -R apache:apache /usr/local/share/sams

<H3>8. Смените права доступа на католог /usr/local/share/sams/data на 777</H3>
 Это должен сделать скрипт инсталляции

<H3>9.  Слеюующие шаги вы должны сделать в WEB интерфейсе SAMS</H3>

<H3>10.  Настройка SAMS на использование NTLM авторизации</H3>
Если планируется использовать NTLM авторизацию в домене Windows NT 4.0, <A HREF="samba.html">настройте winbind</A>, 
а также <A HREF="squid.html#NT4">squid</A> на работу с winbind-авторизацией.
<BR>Если планируется использовать NTLM авторизацию в домене Windows 2000/2003, <A HREF="samba3.html">настройте winbind</A>, 
а также <A HREF="squid.html#WIN2K">squid</A> на работу с winbind-авторизацией.

<BR> Если планируется использовать <A HREF="adldap.html">LDAP авторизацию в Active Directory</A>, 
настройте <A HREF="squid.html#ADLD">squid</A> на работу с авторизацией в AD.


<H3>11. Настройка чтения логов SQUID</H3>
Чтение логов SQUID и занесение данных в базу данных SAMS может производится путем периодического 
чтения файла логов squid access.log
<P> 11.1 - /usr/local/bin/sams - запускается периодически и считывает информацию из файла access.log.
 Необходимо осуществлять запуск этой программы с периодичностью 1 раз в минуту.
<P> Запуск программы sams может быть произведено samdaemon автоматически
<A HREF="settings.html#GETLOGS">(см. настройку <B>samsdaemon</b>)</A> или из cron
<BR>   Для запуска ис cron  создайте демону cron задание:
<BR>    */1 * * * * /usr/local/bin/sams
<P> 11.2 - /usr/local/bin/samsf - после запуска остается в памяти демоном, устанавливает fifo файл access.log. 
Этот режим на данный момент работает нестабильно, и использовать его не рекомендуется


<H3>12. Очистка счетчиков трафика пользователей</H3>
SAMS ведет учет объема информации, полученной пользователями. По превышении
объема информации, пользователь отключается от доступа к прокси-серверу.
<P>Необходимо настроить очистку счетчиков трафика пользователей. Это может быть произведено
samdaemon автоматически <A HREF="settings.html#CLRCNT">(см. настройку <B>samsdaemon</b>) </A>
<P>    или создайте демону cron задание:
<BR>    0 0 1 * * /usr/local/sams/bin/sams -c

<H3>13. Настройка запуска samsdaemon </H3>
Настройте систему на автоматический запуск демона
<BR>    /usr/local/bin/samsdaemon, необходимого для работы SAMS.

<H3>14. Дополнительно:</H3>
Незабудьте раскомментировать в php.ini вызов библиотеки mysql.so




</BODY></HTML>
