<HTML>
<BODY>

<H2 align="center">О SAMS</H2>
<H3 align="center">Состав SAMS</H3>
При инсталляции SAMS будут установлены следующие элементы:
<LI><B>WEB интерфейс</B> (путь по-умолчанию /usr/local/share/sams)
<LI><B>samsdaemon</B> (путь по-умолчанию /usr/local/bin)
<LI><B>sams</B> (путь по-умолчанию /usr/local/bin)
<LI><B>samsf</B> (путь по-умолчанию /usr/local/bin)
<LI><B>samsredir</B> (путь по-умолчанию /usr/local/bin)

<P>
<IMG SRC="../img/sams_work.gif">
<P>

<H3 align="center">WEB интерфейс SAMS</H3>
Предназначен для администрирования SAMS

<H3 align="center">samsdaemon</H3>
Демон, обеспечивающий совместное функционирование всех частей SAMS. 
<LI>запускает утилиты обработки логов sams или samsf
<LI>вносит изменения в файл конфигурации SQUID squid.conf
<LI>перезапускает SQUID
<LI>очищает счетчики пользователей 
<BR>-d  - включить вывод отладочной информации

samsdaemon 
реконфигурирование прокси сервера SQUID.

<H3 align="center">sams</H3>
Утилита, читающая файл access.log, и заносящая данные о трафике 
пользователей в базу данных данных. При превышении объема трафика,
 полученного пользователем, выдается команда на его отключение. 
<BR>
Запуск утилиты обеспечивает samsdaemon.
<BR>
Ключи:
<BR>-c  - очистить счетчики трафика пользователей
<BR>-d  - включить вывод отладочной информации
<BR>По-умолчанию очистка счетчика трафика пользователей должна происходить 
первого числа каждого месяца. Если вы хотите очищать счетчики трафика чаще, 
настройте запуск утилиты sams с ключем -c при помощи cron. 


<H3 align="center">samsf</H3>
Утилита, замещающая файл access.log fifo файлом (/var/log/squid/!access.log), и заносящая данные о 
трафике пользователей в базу данных данных. SQUID заносит данные 
непосредственно в fifo файл, на вход samsf. Данные обрабатываются непрерывно, 
и при превышении объема трафика,  полученного пользователем, выдается 
команда на его отключение. 
<BR>
Запуск утилиты обеспечивает samsdaemon.
<BR>
Ключи:
<BR>-d  - включить вывод отладочной информации. При данном ключе samsf 
не переходит в режим демона, и отладочная информация выводится в консоль.


<H3 align="center">samsredir</H3>
Редиректор SAMS. Запуск samsredir должен быть прописан в файле squid.conf.
<BR>samsredir обеспечивает:
<LI>запрет доступа пользователей к SQUID
<LI>запрет доступа пользователей к запрещенным ресурсам
<LI>перенаправление запросов пользователей к графичиским ресурсам 
(баннерам, счетчикам и т.п.)
<LI>ограничение времени доступа пользователей к SQUID 
<BR>
Если в настройках SAMS стоит использование samsredir, в ACL файлах
SQUID доступ разрешен всем пользователям. Запрет доступа пользователей
и ограничение времени доступа к SQUID осуществляется редиректором. 

<H3 align="center">Принцип работы SAMS</H3>
Через <B>web интерфейс</B> происходит настройка всех параметров SAMS:
<LI>принцип авторизации пользователей в SQUID
<LI>регистрация пользователей SQUID и настройка их свойств (квота на трафик, 
запрет доступа и т.п.)
<LI>настройка запрета доступа пользователей к нежелательным ресурсам интернет
<LI>просмотр отчетов по посещенным пользователями ресурсам.
<LI>просмотр журнала событий SAMS
<LI>выдача команды на реконфигурирование SQUID
<LI>настройка чтения данных из логов SQUID

<P>Обработка логов SQUID производится двумя утилитами:
<LI>sams
<LI>samsf
<P>программа <B>sams</B> регулярно вызывается демоном samsdaemon для чтения 
файла логов SQUID access.log и занесения данных в базу данных MySQL. При превышении 
пользователем квоты трафика происходит отключение пользователя и выдача команды на 
реконфигурирование SQUID.

<P>демон <B>samsf</B> запускается демоном samsdaemon и создает fifo файл access.log, 
в кторой SQUID пишет свои логи. Если уже существовал текстовый файл access.log, 
он переносится в файл access.log.{time stamp}.
 Демон samsf заносит данные о трафике в базу данных MySQL. 
<BR>Обработка данных демоном 
 samsf происходит непрерывно, и реакция на превышение 
пользователем трафика более быстрая, чем утилиты sams.
 При превышении пользователем квоты трафика происходит отключение 
пользователя и выдача команды на реконфигурирование SQUID.


<P>демон <B>samsdaemon</B> постоянно ждет команду на реконфигурирование SQUID. 
При ее получении от WEB интерфейса sams или программ sams и samsf samsdaemon призводит:
<LI>создает файлы ACL 
<LI>прописывает ACL в squid.conf
<LI>реконфигурирует SQUID
<BR>Samsdaemon изменяет squid.conf привязываясь к тегам начала разделов. 
По-этому все тэги должны быть на месте. При изменении squid.conf удаляются 
только настройки, внесенные для работы с sams 
(они содержат в себе строку "_sams_"). 


<P>Редиректор <B>samsredir</B> запускается при старте SQUID. На основе информации о 
пользователях, полученной из базы данных SAMS редиректор производит:
<LI>разрешает допуск пользователей в интернет
<LI>запрещает доступ пользователей к запрещенным ресурсам
<LI>перенаправляет запросы пользователей к графическим файлам (баннерам и т.п.)



</BODY>
</HTML>
