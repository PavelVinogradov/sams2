<HTML>
<HEAD>
<TITLE>Проект SAMS. Документация.</TITLE>
<META  content="text/html; charset=koi8-r" http-equiv="Content-Type">
</HEAD>
<BODY>
<FONT SIZE=-1>Эта документация основана на статье Д.Новикова "Авторизация Windows-
пользователей в SQUID на основе их доменных аккаунтов"
<BR>Оригинал: http://www.artmagic.ru/labs/sqlandwin.shtml
</FONT>

 <H2>Инсталляция и настройка программного обеспечения</H2>


<H3 ID="CREATEBASE">Установка и создание базы SAMS в MySQL.</H3>
<P>Скачайте и разархивируйте исходные коды MySQL:
<P>tar xvfz mysql-x.x.tar.gz
<P>далее компилируем и инсталлируем MySQL:
<P>make
<BR>make install

<H3 ID="WEBCONF">Установка и конфигурация базы данных MySQL из WEB интерфейса.</H3>
Если при первом запуске WEB интерфеса база данных небыла создана, будет выдано 
предупреждение и предложено создать базу данных.
<P><IMG SRC="../img/createdb1.jpg" ALIGN="CENTER">

<P>В следующем диалоге  будут выданы ошибки, если установлены не все необходимые
для веб-интерфейса функции php и диалог, в котором будет предложено ввести параметры, 
необходимые для создания базы данных SAMS.
<P><IMG SRC="../img/createdb2.jpg" ALIGN="CENTER">
<P>где:
<P><B>MySQL Hostname</B> - Адрес хоста, где стоит MySQL
<BR><B>MySQL login</B> - имя пользователя MySQL, имеющего право создавать базы данных (root)
<BR><B>MySQL login</B> - пароль пользователя MySQL, имеющего право создавать базы данных
<BR><B>Create SAMS MySQL user</B> - если checkbox установлен, будут активированы поля для создания:
<BR><B>SAMS MySQL user</B> - имя пользователя sams в MySQL
<BR><B>SAMS MySQL user password</B> - пароль
<P>Далее нажимаем на кнопку "Create Database". Если база данных будет выдано сообщение 
об этом и предложение запустить WEB интерфейс SAMS

<P><IMG SRC="../img/createdb3.jpg" ALIGN="CENTER">

<H3 ID="CONSCONF">Установка и конфигурация базы данных MySQL из консоли.</H3>


<P>Создание пользователя MySQL.
<BR>Для работы SAMS необходимо в MySQL создать пользователя со всеми правами на базы squidctrl и squidlog.
MySQL позволяет создать пользователя и назначить ему базу до того, как сама база будет создана.

<P><B>Создание пользователя вручную</B>
<BR>Зайдите в консоль MySQL:
<BR>mysql -u root -p  (Если у вас пароль пользователя root пустой, ключ -p не используйте)
<BR>Выполните там команды:
<BR>GRANT ALL ON squidctrl.* TO sams@localhost IDENTIFIED BY "yourpassword";
<BR>GRANT ALL ON squidlog.* TO sams@localhost IDENTIFIED BY "yourpassword";
<BR>Где:
<BR> yourpassword - пароль
<BR>Занесите имя пользователя и пароль в файл конфигурации SAMS /etc/sams.conf

<P><B>Создание пользователя скриптом</B>
<BR>Отредактируйте файл /sams-XXXXXX/mysql/create_sams_user.sql и измените пароль пользователя в строках:
<BR>GRANT ALL ON squidctrl.* TO sams@localhost IDENTIFIED BY "yourpassword";
<BR>GRANT ALL ON squidlog.* TO sams@localhost IDENTIFIED BY "yourpassword";
<BR>Где:
<BR> yourpassword - пароль
<BR>Запустите скрипт /sams-XXXXXX/mysql/create_sams_user для создания пользователя.
<BR>Этот скрипт выполняется от имени пользователя root. Если у вас  пользователь root имеет пароль по-умолчанию (пустой),
отредактируйте скрипт, удалив из строки
<BR>mysql -u root -p < create_sams_user.sql      ключ -p
<BR>Занесите имя пользователя и пароль в файл конфигурации SAMS /etc/sams.conf

<P><B>Создание базы данных SAMS:</B>
<BR>Из каталога mysql выполните скрипты create_sams_db и create_squid_db.
<BR>Эти скрипты по-умолчанию выполняются от имени пользователя, прописанного в sams.conf.
<BR>Если у вас в sams.conf прописан пользователь root, а пароль пользователя mysql root оставлен
по-умолчанию (пустой), отредактируйте скрипты, удалив из строк
<BR>mysql -u $USER -p < xxxx_db.sql ключ -p

</BODY>
</HTML>
