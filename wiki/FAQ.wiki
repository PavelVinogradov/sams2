#summary Часто задаваемые вопросы (FAW)

== Web-Interface ==

====Автоматически не активируется пользователь после блокировки.====
  После превышения квоты пользователь успешно блокируется, но если увеличить ему трафик и выставить "Активен" редиректор все одно не пускает, хотя и меняет содержимое выдаваемой странички на:
  {{{
    Пользователь XXX

    Доступ к прокси-серверу запрещен

    Access denied
  }}}
  
  Если же ручками переконфигурить Squid или послать ему HUP, то доступ восстанавливается.*

После ручной активации пользователя необходимо реконфигурировать squid, иначе он не узнает о активации этого пользователя.

Автоматически это не делается т.к. возможно администратор будет вручную активировать 10к пользователи и не хочется после каждого переконфигурировать squid.
 
====После установки, при обращении из браузера отображается ошибка====

  На странице SAMS во всех трёх фрэймах: 
  {{{
     Fatal error: Call to undefined function: mysql_connect() in /usr/local/share/sams/mysqltools.php on line XXX
  }}}

В php не установлена поддержка MySQL (php-mysql)

====После установки sams выводится ошибка: Warning: fopen()====
  Выводится ошибка: Warning: fopen() [function.fopen]: SAFE MODE Restriction in effect. The script whose uid is xxxx is not allowed to access /etc/sams.conf owned by uid yyyy in /usr/local/share/sams/mysqltools.php on line xxxx

С версии 240507 web-интерфейс sams работает в режиме php *safe_mode = on*. При этом пользователь которому принадлежат php скрипты не может (по умолчанию) читать обращаться из этих скриптов к файлам принадлежащих другим пользователям. Для решения этой проблемы смени фладельца конфигурационного файла чтобы он совпадал с владельцем php скриптов sams. 

===На срабатывает сохранение настроек в web-интерфейсе====

  Поставил SAMS. Настройки интерфейса сохранил, пароль администратора изменил, пытаюсь в администрировании SAMS что-либо менять, нажимаю сохранить и в правом фрейме появляется иконка (ключ с отверткой) и все. Опять жму ее - тоже самое, пока страницу не обновишь, появляется страница с настройками, но все как было так и осталось не измененное.  Firefox почему-то дает такой эффект, в Konqueror все нормально*

У вас установлен плагин фильтрации рекламы типа adBlock. Его необходимо отключить для web-интерфейса SAMS.

== Авторизация ==
====NTLM авторизация====

  Пользователей в инет пускает, однако трафик в базу не заносится и не считается. Подскажите, куда копать?

В access.log используется конструкция domain\user, а в веб-интерфейсе не стоит галочка "Включить использование домена пользователя"

====После смены пароля администратора с помощью setpassword.php - не могу авторизоваться. ОС: FreeBSD 6.x====

Есть информация что в ветке 6.x FreeBSD используется шифрование md5, тогда как setpassword использует bluefish.

====Я все настроил верно, но sams выдает: mysql_real_connect() error 0. no open database squidctrl, DELAY 3 sec====

Проверьте что пароль пользователя sams к БД MySQL не содержит символа #. (Подробнее issue 78)

== Редиректоры ==
*Пользователей в инет пускает, трафик считается, но по превышении юзеры не отключаются и продолжают ходить в инет. В web интерфейсе показывает, что пользователь отключен, а в squid.conf пользовател занесен в acl, которому разрешен доступ в инет.*

У вас в настройках SAMS стоит "Использовать редиректор SAMS", а использование редиректора не прописано в squid.conf. В этом режиме в squid.conf  доступ  разрешен всем, а обязанность пущать/непущать юзеров возложена на редиректор. Пропишите используемый редиректор в squid.conf, или поставьте "Не использовать редиректор"

== Функционал ==
*У пользователя установлен лимит 100 мб/месяц. Он у него заканчивается 25го числа, тот идет у начальству, просит, ему добавляют еще 10 мб. Пользователь с подписанной служебкой идет к админу и грит, вот ... добавь ...*

*DmitryChemerik*:
{{{
  Добавления лимита трафика пользователю не будет. Это моя позиция. Основанная на личном опыте.

У меня в конторе одно время практиковалось увеличивать лимит при превышении его пользователем. Соответственно увеличивать   приходилось каждый месяц. При том что у пользователей лимит итак по 500-700 метров. Зафиксировав лимит и сделав пользователям внушение, процесс был остановлен, ну разве что это приходится делать изредка, при обоснованном пользователем превышении.
}}}

== Демоны ==
*У меня возникают проблемы при использовании samsf (Constant parser). Он работает нестабильно, а иногда при реконфигурации перестает работать Squid*

*Pavel Vinogradov*:
{{{
samsf в данный момент доступен только для совместимости со старыми инсталяциями, он официально не поддерживается т.к. содержит очень большое дублирование кода из sams. В версии 1.1 и 2.0 samsf будет убран.
Рекомендуется использовать sams (Discret parser)
}}}

====Sams при реконфигурировании затирает параметр reply_body_max_size====

  Ставлю в конфиге squid руками 
  {{{
    reply_body_max_size 1000000 allow _sams_default
  }}}
  При следующем реконфигурировании сквида из самс этот параметр затирается!
 
Временное решение от *gonzo111*:
 Баг вытирания строчки самсом решил так - простым добавлением своего ACL
{{{
acl _sams_default src "/usr/local/etc/squid/default.sams"

acl sams_default src "/usr/local/etc/squid/default.sams"

#reply_body_max_size 1000 allow _sams_default эту строку самс после реконфига удалял, а чужие acl он не трогает :)

reply_body_max_size 1000 allow !sams_default #будет резать закачку больше 1000 байт только acl sams_default
}}}