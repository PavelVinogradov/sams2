<HTML>
<BODY>
<H2 align="center">Администрирование SAMS</H2>
<H3 align="center" ID="WEBSETTINGS">Настройка графического интерфейса SAMS</H3>
Для настройки WEB интерфейса SAMS необходимо в дереве настроек 
WEB интерфейса SAMS выбрать пункт "Настройки WEB интерфейса", 
далее в нижнем фрейме нажать кнопку <IMG SRC="../img/config_32.jpg">.
<P>
В открывшемс диалоге установите:

<LI><B>Language: (Язык)</B>	Язык (кодировка) веб интерфейса
<LI><B>Allow the users access to your own statisatics (Разрешить доступ пользователей к своей статистике)</B>: 
- Позволяет пользователям авторизоваться в WEB интерфейсе SAMS для просмотра своей статистики: 
<BR> - <B>on daily traffic (по трафику за день)</B>  - показывает объем скаченного пользователем трафика по дням	
<BR> - <B>on URL visiting (по посещенным URL)</B> - показывает пользователю список посещенных им URL	
<LI><B>Icon set (Тема иконок)</B> - тема иконок WEB-интерфейса	

<LI><B>Show users tree (Показывать дерево пользователей)</B> - Включение/выключение показа
дерева пользователей в левом фрейме SAMS при заходе в вебинтерфейс пользователя не-администратора

<LI><B>Show users as (Показывать пользователей как)</B> - выбрать как будут показываться пользователи в левом 
фрейме  WEB интерфейса. 
<BR> - Пользователь
<BR> - Пользователь / Домен
<BR> - Фамилия
<BR> - Фамилия Имя
<LI><B>Kilobyte size of your ISP (byte) (Размер Килобайта, учитываемого вашим провайдером (byte))</B> 	
<LI><B>Megabyte size of your ISP (byte) (Размер Мегабайта, учитываемого вашим провайдером (byte) )</B>	
- к сожалению наши провайдеры часто имеют достаточно странное мнение о размере таких единиц 
измерения как килобайт и мегабайт. Например, мегабайт может быть равен 1000000 
байт. Объяснется это обычно удобством подсчета трафика пользователями, хотя если 
посчитать, то на уменьшении размера менабпйта до этого размера пользователи теряют 
примерно 48 килобайт трафика, что составляет 2.4% трафика :(
<LI><B>Create diagrams (Показывать графики в отчетах )</B> 
-  в некоторых отчетах рисуются графики	
<LI><B>Create PDF reports:(Создавать PDF отчеты)</B> - ежедневно создаются pdf отчеты о трафике пользователей 
(данный режи несовсем проработан)

<P>
Для сохранения настроек нажмите кнопку "Сохранить изменения".
<P>
<IMG SRC="../img/websettings.jpg" ALIGN="CENTER">
<P>


<H3 align="center" ID="SAMSSETTINGS">Настройка SAMS</H3>

Для настройки WEB интерфейса SAMS необходимо в дереве настроек 
WEB интерфейса SAMS выбрать пункт "Настройки SAMS", 
далее в нижнем фрейме нажать кнопку <IMG SRC="../img/config_32.jpg">.
<P>

<IMG SRC="../img/samssettings.jpg" ALIGN="CENTER">
<P>
В открывшемся диалоге установите:

<P><B>Подсчет трафика пользователей:</B>
<P><B>для пользователей считать трафик:</B>
<LI><B>Реальный</B> трафик, полученный пользователем без учета трафика из кэша.
<LI><B>Полный</B> полный трафик, полученный пользователем

<P><B>Преобразовывать DNS имена</B> - преобразовывать URL в IP адреса при 
обработке логов SQUID. 
Необходимо выставить эту галочку если у вашего провайдера есть региональный бесплатный 
трафик и вы внесли диапазон этих ip адресов в список локальных доменов. При обработке 
логов будет производиться преобразование доменных имен в ip адрес и проверка ip на 
вхождение в бесплатный диапазон.

<P><B>Уровень детализации записей в журнале</B> - чем выше число в этом поле, тем 
детальнее будут логи заноситься в журнал. Рекомендую выставлять высокую детализацию 
логов только на период отладки. При нормальной эксплуатации нужно выставить уровень 
детализации равным 0.


<P><B>Домен по умолчанию</B> - название домена, которое по-умолчанию подставится в свойства 
пользователя.

<P><B>Выберите скрипт, используемый для отправки сообщения при отключении пользователей</B> - 
При отключении пользователей sams может может выполнять скрипт для отправки сообщений 
администратору.


<P><B>Настройка авторизации пользователя:</B> в этом пункте призводится настройка SAMS на
различные виды авторизации доступа пользователей к прокси-серверу. 
<BR><FONT color="BLUE"><B>Эта настройка служит для определения  
авторизации пользователей на прокси-сервере SQUID по-умолчанию.</B></FONT> 
Способ авторизации задается для пользователей шаблона в <A HREF="shablons.html#AUTH"> свойствах 
шаблона пользователей</A>. 


<TABLE WIDTH="95%">
<TR><TD VALIGN=TOP><B>NTLM
<BR>Active Directory
<TD VALIGN=TOP> настройка SAMS на NTLM авторизацию (Windows NT domain) или в Active Directory
<P><FONT COLOR=BLUE> Различие между NTLM и AD в способах получения списков пользователей с контроллера домена 
и авторизации пользователей в web интерфейсе SAMS.
<BR><B>NTLM</B> 
<BR> получение списка пользователей домена и авторизация происходит посредством демона winbind 
и команды wbinfo.
<BR><B>Active Directory</B> 
<BR> получение списка пользователей домена и авторизация происходит посредством средств работы php
с LDAP. 
<P>Авторизация пользователей SQUID в домене в обоих случаях может настраиваться согласно документации по 
NTLM авторизации. 
<P>Для ActiveDirectory также возможно испозовать авторизацию SQUID в домене LDAP.
Для этого необходимо использовать хелпер SQUID squid_ldap_auth
<BR>Пример вызова squid_ldap_auth в squid.conf: 
<BR><em>/usr/lib/squid/squid_ldap_auth -u cn -b "cn=Users,dc=your,dc=domain" ldapserver</em>
</FONT>


<P><B>Включить использование домена пользователя</B> включить этот пункт, если у вас в сети
несколько доменов и при авторизации
пользователя используется конструкция domain+user
<BR><B>Домен пользователя выводится ПРОПИСНЫМИ буквами</B> включить этот пункт, если ваш
контроллер домена при авторизации требует ввод имени домена прописными буквами. Посмотреть
тебование контроллера домена можно командой
<BR> wbinfo -u
<BR><B>Имя пользователя выводится ПРОПИСНЫМИ буквами</B> включить этот пункт, если ваш
контроллер домена при авторизации требует ввод имени пользователя прописными буквами. Посмотреть
требование контроллера домена можно командой
<BR> wbinfo -u
<BR><B>Перекодировать имена пользователей домена</B> включить этот пункт, если название домена или
имена пользователей домена в контроллере домена
введены в национальной кодировке, отличающейся от используемой в SAMS.
Перекодировка файлов производится вызовом команды, прописанной в sams.conf
<BR>Например для русского языка: В домене Windows при передаче имен пользователей используется
кодировка DOS-866, в SAMS имена хранятся в кодировке KOI8-R. Необходимо при правил прокси-сервера SQUID
призвести перекодировку файлов из KOI8-R в DOS-866.
<BR>команда на перекодировку:
<BR>iconv -f KOI8-R -t 866 %finp > %fout
<BR> %finp - обозначается файл, который будет перекодирован
<BR> %fout - имя файла, в который будет сохранен перекодированный файл (если это требуется)
<TR><TD VALIGN=TOP><B>NCSA
<TD VALIGN=TOP> настройка SAMS на NCSA авторизацию
<TR><TD VALIGN=TOP><B>IP
<TD VALIGN=TOP> настройка SAMS на доступ по ip адресу
</TABLE>

<H3>Настройка samsdaemon</H3> 
В этом пункте настраивается samsdaemon - программа производящая
переконфигурирование и перезапуск прокси-сервера.
<P><TABLE WIDTH="95%" BORDER="1">
<TR><TD VALIGN=TOP><B>Проверять наличие команды на реконфигурирование SQUID каждые
<TD VALIGN=TOP>настройка частоты посылки запросов samsdaemon на реконфигурирование SQUID.
 От частоты посылки запросов зависит оперативность выполнения команды на реконфигурирование SQUID.
 Минимальная периодичность - 1 секунда.

<TR ID="GETLOGS"><TD VALIGN=TOP><B>Обрабатывать логи SQUID
<TD VALIGN=TOP> Разрешить samsdaemon запускать программы, обрабатывающие логи SQUID и заносящие данные
о трафике пользователей в базы SAMS
<BR><B>Обрабатывать логи непрерывно</B> при старте samsdaemon запускается программу samsf,
открывающую FIFO файл (/var/log/squid/!access.log) вместо файла логов SQUID access.log. 
SQUID пишет логи прямо в FIFO файл.
<BR><B>Запускать обработчик логов через N мину</B> через N минут samsdaemon запускает программу sams, 
читающую данные о трафике пользователей из файла логов SQUID access.conf
<BR><B>читать через ... минут </B> время, через которое происходит чтение логов SQUID программой sams

<TR ID="CLRCNT"><TD><B>Автоматически очищать счетчики трафика пользователей 	 </B>
<TD>включить автоматическую очитстку счетчиков трафика пользователей SAMS. Сброс
трафика происходит в зависимости от настроек в шаблонах пользователей.

<TR><TD VALIGN=TOP><B>Путь к wbinfo:
<TD VALIGN=TOP>При NTLM авторизации для получения списков пользователей от контроллера домена
используется программа wbinfo. Так как в различных ОС wbinfo может находиться в различных местах,
необходимо прописать полный путь к нему.
<TR><TD VALIGN=TOP><B>Файл перенаправления запроса
<TD VALIGN=TOP> Если в системе используется редиректор, поддерживаемый SAMS, необходимо прописать
графический файл, которым редиректор будет подменять графические запросы (баннеры и т.п.)
<TR><TD VALIGN=TOP><B>Путь к каталогу, где лежат файлы запрета запроса
<TD VALIGN=TOP> Если в системе используется редиректор samsredir, необходимо прописать
путь к каталогу, в котором лежат файлы, которые редиректор будет выдавать пользователю взамен запросов
к URL, запрещенных к доступу
<TR><TD VALIGN=TOP><B>Редиректор
<TD VALIGN=TOP> Выбирается редиректор, который будет использоваться совместно с SAMS
<TR><TD VALIGN=TOP><B>Включить ограничение скорости доступа пользователей (delaypool)
<TD VALIGN=TOP> Включение деление скорости канала для групп пользователей.
<TR><TD VALIGN=TOP><B>
Сохранять данные о трафике в базе за последние</B>
<TD> SAMS может автоматически сохранять backup базы логов squid. Выберите количество месяцев, 
данные за которые будут храниться в базе. Первого числа месяца данные будут записаны на диск 
в виде текстого файла с SQL запросами, и удалены из базы данных.
</TABLE>


</BODY>
</HTML>
